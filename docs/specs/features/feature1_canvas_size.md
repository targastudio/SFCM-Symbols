# Feature 6.1 — Canvas Size Options  
Enhancement Specification  
Version: 1.0  
Location: docs/extrafeatures/feature1_canvas_size.md

## Overview
This feature adds full support for choosing different canvas sizes for both:
- The **SVG preview** rendered by `<SvgPreview />`
- The **SVG export** generated by `DownloadSvgButton`

The generation logic (clusters, lines, curves, branching, replication, animation) **must not change**.  
Only the canvas dimensions and viewBox should be affected.

---

# Goals

## 1. Provide Canvas Size Presets
Add a selector for the following formats:
- **1:1** (1080×1080)
- **4:5** (1080×1350)
- **9:16** (1080×1920)
- **16:9** (1920×1080)
- **Fit screen** (uses current viewport on client side)
- **Custom** (user inputs width/height in px)

The selector will use **radio buttons** for now.

## 2. Reflect Canvas Size in Preview
`SvgPreview` must accept the following new props:
- `canvasWidth: number`
- `canvasHeight: number`

And use them for:
- `<svg width="..." height="...">`
- `<svg viewBox="0 0 width height">`
- Background `<rect>` size

The geometry (points, lines, curves) must NOT change scale or behavior.

## 3. Reflect Canvas Size in Export
The exported SVG must:
- Have the same `width`, `height`, `viewBox` used in preview
- Preserve all styling (stroke-width 3px, arrowhead 14×19px, bg black)
- Work identically in Illustrator, Figma, browser

The export helper (`prepareSvgForExport.ts`) must apply the size consistently.

---

# Requirements

## 1. Data Model

Create a new file:

```
lib/canvasSizeConfig.ts
```

With:

### Types
```ts
export type CanvasSizeId =
  | "square"
  | "4_5"
  | "9_16"
  | "16_9"
  | "fit"
  | "custom";
```

### Preset Map
```ts
export const CANVAS_PRESETS = {
  square: { width: 1080, height: 1080 },
  "4_5": { width: 1080, height: 1350 },
  "9_16": { width: 1080, height: 1920 },
  "16_9": { width: 1920, height: 1080 },
  fit: { responsive: true },
  custom: { custom: true },
} as const;
```

### Helper
```ts
export function resolveCanvasSize(
  id: CanvasSizeId,
  customWidth?: number,
  customHeight?: number,
  viewportWidth?: number,
  viewportHeight?: number
): { width: number; height: number }
```

Rules:
- If preset → return stored size
- If fit → use viewport size (fallback 1080×1080 until hydrated on client)
- If custom → return validated custom width/height

---

# 2. UI Implementation (app/page.tsx)

Add new React state:

```ts
const [canvasSizeId, setCanvasSizeId] = useState<CanvasSizeId>("square");
const [customWidth, setCustomWidth] = useState<number | "">("");
const [customHeight, setCustomHeight] = useState<number | "">("");
const [viewportWidth, setViewportWidth] = useState<number>(1080);
const [viewportHeight, setViewportHeight] = useState<number>(1080);
```

### Fit-screen logic
Use a `useEffect`:

```ts
useEffect(() => {
  if (canvasSizeId === "fit") {
    setViewportWidth(window.innerWidth);
    setViewportHeight(window.innerHeight);
  }
}, [canvasSizeId]);
```

### Radio group
Add radio inputs for:
- square  
- 4_5  
- 9_16  
- 16_9  
- fit  
- custom  

If custom:
- Show 2 numeric inputs for width / height.

### Validation
If custom inputs are empty or invalid:
- Disable "Genera" button  
or  
- Show an error message (optional)

---

# 3. Passing Canvas Size to preview and export

Where we compute connections, also compute:

```ts
const { width: canvasWidth, height: canvasHeight } =
  resolveCanvasSize(canvasSizeId, customWidth, customHeight, viewportWidth, viewportHeight);
```

Pass these values to:

### SvgPreview
```tsx
<SvgPreview
  connections={connections}
  animationEnabled={animationEnabled}
  animationProgress={animationProgress}
  canvasWidth={canvasWidth}
  canvasHeight={canvasHeight}
/>
```

### DownloadSvgButton
```tsx
<DownloadSvgButton
  connections={connections}
  canvasWidth={canvasWidth}
  canvasHeight={canvasHeight}
/>
```

---

# 4. SvgPreview Update

Modify `<svg>` tag:

```tsx
<svg
  width={canvasWidth}
  height={canvasHeight}
  viewBox={`0 0 ${canvasWidth} ${canvasHeight}`}
  className="svg-preview"
  xmlns="http://www.w3.org/2000/svg"
>
```

Modify background rect:

```tsx
<rect x="0" y="0" width={canvasWidth} height={canvasHeight} fill={BACKGROUND_COLOR} />
```

All strokes and arrowheads remain unchanged:  
- stroke-width: 3px  
- arrowhead: 14×19px  

No scaling.

---

# 5. Export Update (prepareSvgForExport.ts)

Clone the DOM SVG and enforce:

```ts
svg.setAttribute("width", canvasWidth.toString());
svg.setAttribute("height", canvasHeight.toString());
svg.setAttribute("viewBox", `0 0 ${canvasWidth} ${canvasHeight}`);
```

Ensure black background rect is updated to match.

No other logic changes — keep the current stable export pipeline.

---

# 6. Testing Requirements

### For each preset:
| Format | Expected canvas |
|--------|----------------|
| 1:1 | 1080×1080 |
| 4:5 | 1080×1350 |
| 9:16 | 1080×1920 |
| 16:9 | 1920×1080 |
| Fit screen | Browser viewport |
| Custom | User-defined |

### In Preview:
- Lines scale spatially according to coordinate system  
- Stroke stays 3px  
- Arrowheads stay 14×19px  

### In Export:
Open in Illustrator/Figma → MUST match the preview exactly.

---

# 7. Out of Scope

This feature does **NOT** modify:
- Cluster generation
- Curve logic
- Branching logic
- Arrowhead styling logic
- Animation logic
- Export styling beyond canvas dimensions

---

# 8. Acceptance Criteria

A. User can select any canvas preset  
B. User can input custom width/height  
C. Preview SVG uses correct width/height/viewBox  
D. Exported SVG uses correct width/height/viewBox  
E. Stroke/arrowheads remain at fixed px values (no scaling)  
F. Illustrator and Figma show identical results to the preview  
G. No hydration mismatch errors  

---

# End of File
